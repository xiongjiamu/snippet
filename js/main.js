/**
 * Created by zhangw on 2016-5-23.
 */

/************************************ DATA *************************************************/
CodeIdsData = {
    "1":{
        "80-100":["blog;;6790560;;0","blog;;47171565;;2","blog;;8184175;;1"],
        "60-80":["blog;;25598035;;0","blog;;6930587;;1","blog;;9421163;;0"],
        "40-60":["blog;;8847072;;0","blog;;50440407;;0","blog;;39494469;;0"],
        "20-40":["blog;;43968209;;0","blog;;6625590;;0","blog;;39434095;;0"],
        "0-20":["blog;;26423493;;0","blog;;46381825;;3","blog;;8050239;;4"]
    },
    /* java+struts2 */
    "2": {
        "80-100": ["blog;;7299491;;0","blog;;6774432;;0","blog;;48580329;;0"],
        "60-80": ["blog;;6926397;;0","blog;;50262537;;0","blog;;7210630;;0"],
        "40-60": ["blog;;6966182;;0","blog;;48526935;;0","blog;;8077529;;0"],
        "20-40": ["blog;;6960307;;0","blog;;8836742;;0","blog;;7608311;;0"],
        "0-20": ["blog;;50837598;;0","blog;;51006985;;0","blog;;7632933;;0"]
    },
    /* java+spring */
    "3": {
        "80-100": ["blog;;49420555;;0","blog;;51079706;;0","blog;;44699347;;0"],
        "60-80": ["blog;;50282169;;2","blog;;7285055;;0","blog;;6827642;;4"],
        "40-60": ["blog;;51304073;;0","blog;;26258967;;0","blog;;49888191;;23"],
        "20-40": ["blog;;49450045;;0","blog;;48240303;;3","blog;;50379518;;0"],
        "0-20": ["blog;;48826523;;0","blog;;48196779;;0","blog;;45934121;;0"]
    },
    /* java+JDBC+java */
    "4": {
        "80-100": ["blog;;49930537;;0","blog;;9112875;;0","blog;;51233041;;0"],
        "60-80": ["blog;;7867439;;0","blog;;51292476;;0","blog;;47152741;;0"],
        "40-60": ["blog;;51149068;;0","blog;;16850313;;0","blog;;7854850;;0"],
        "20-40": ["blog;;7527099;;0","blog;;50801617;;0","blog;;50358868;;0"],
        "0-20": ["blog;;21562567;;1","blog;;50240615;;0","blog;;7398994;;0"]
    },
    /*命令行工具+python*/
    "5": {
        "80-100": ["blog;;50274023;;0","blog;;42262353;;0","blog;;51281116;;0"],
        "60-80": ["blog;;7768845;;0","blog;;17028421;;0","blog;;18659547;;3"],
        "40-60": ["blog;;50116661;;0","blog;;47174005;;0","blog;;39902327;;0"],
        "20-40": ["blog;;50465451;;0","blog;;48528397;;0","blog;;50536736;;0"],
        "0-20": ["blog;;47789873;;11","blog;;7566842;;0","blog;;6713100;;0"]
    },
    /*CLI+python*/
    "6": {
        "80-100": ["blog;;35570883;;0","blog;;7980556;;0","blog;;7652466;;0"],
        "60-80": ["blog;;50435468;;0","blog;;47789257;;0","blog;;18659547;;3"],
        "40-60": ["blog;;15498823;;3","blog;;14518977;;6","blog;;45721249;;0"],
        "20-40": ["blog;;14518977;;3","blog;;7835065;;2","blog;;43542039;;0"],
        "0-20": ["blog;;7947768;;0","blog;;8330104;;7","blog;;8911468;;4"]
    },
    /*3D+python*/
    "7": {
        "80-100": ["blog;;7734129;;0", "blog;;11531829;;0", "blog;;6958458;;0"],
        "60-80": ["blog;;7730673;;0", "blog;;8946537;;1", "blog;;24325813;;0"],
        "40-60": ["blog;;6946657;;0", "blog;;8672228;;0", "blog;;8309058;;5"],
        "20-40": ["blog;;43542039;;0", "blog;;49783095;;0", "blog;;51385903;;0"],
        "0-20": ["blog;;8885075;;3", "blog;;45286693;;7", "blog;;8367957;;8"]
    },
    /*编码规范+python*/
    "8": {
        "80-100": ["blog;;8293411;;0", "blog;;16920541;;6", "blog;;7982903;;0"],
        "60-80": ["blog;;16892997;;0", "blog;;17028421;;0", "blog;;38425585;;0"],
        "40-60": ["blog;;48750159;;0", "blog;;42033695;;1", "blog;;46005293;;0"],
        "20-40": ["blog;;40003185;;0", "blog;;6601123;;23", "blog;;26726625;;1"],
        "0-20": ["blog;;12406147;;4", "blog;;8950168;;0", "blog;;8885075;;0"]
    },
    /*多线程+C#*/
    "9": {
        "80-100": ["blog;;50620214;;0", "blog;;7576311;;0", "blog;;6599865;;0"],
        "60-80": ["blog;;7267369;;0", "blog;;7231636;;0", "blog;;7707690;;0"],
        "40-60": ["blog;;7883031;;0", "blog;;6602080;;0", "blog;;7903975;;0"],
        "20-40": ["blog;;7764856;;0", "blog;;50549223;;0", "blog;;7265486;;5"],
        "0-20": ["blog;;7201055;;0", "blog;;50846750;;0", "blog;;47908773;;9"]
    },
    /*反射+C#*/
    "10": {
        "80-100": ["blog;;44514653;;0", "blog;;20639421;;0", "blog;;8373215;;0"],
        "60-80": ["blog;;8796404;;0", "blog;;2620792;;0", "blog;;50243595;;0"],
        "40-60": ["blog;;7238890;;0", "blog;;47657253;;2", "blog;;50807323;;0"],
        "20-40": ["blog;;45579107;;0", "blog;;11653095;;0", "blog;;9721153;;2"],
        "0-20": ["blog;;8978141;;0", "blog;;2515552;;0", "blog;;38109643;;0"]
    },
    /*文件操作+C#*/
    "11": {
        "80-100": ["blog;;6794560;;0", "blog;;7796308;;6", "blog;;7198284;;0"],
        "60-80": ["blog;;6931495;;0", "blog;;6989069;;0", "blog;;51261072;;0"],
        "40-60": ["blog;;8460185;;0", "blog;;7638055;;0", "blog;;6752190;;0"],
        "20-40": ["blog;;50001913;;0", "blog;;7519719;;0", "blog;;50932167;;0"],
        "0-20": ["blog;;8978141;;0", "blog;;51132431;;0", "blog;;38109643;;0"]
    },
    /*设计模式+C#*/
    "12": {
        "80-100": ["blog;;50525692;;0", "blog;;7312752;;0", "blog;;7063302;;37"],
        "60-80": ["blog;;47127467;;0", "blog;;47169159;;0", "blog;;7063302;;36"],
        "40-60": ["blog;;47166201;;0", "blog;;7340020;;0", "blog;;50492395;;0"],
        "20-40": ["blog;;49667247;;0", "blog;;7001456;;0", "blog;;50516682;;0"],
        "0-20": ["blog;;8978141;;0", "blog;;38109643;;0", "blog;;48495043;;0"]
    },
    /*WinForm+C#*/
    "13": {
        "80-100": ["blog;;20639421;;0", "blog;;7785861;;0", "blog;;8373215;;0"],
        "60-80": ["blog;;7399406;;0", "blog;;38868303;;0", "blog;;7823056;;0"],
        "40-60": ["blog;;8844033;;0", "blog;;7783522;;0", "blog;;7694104;;0"],
        "20-40": ["blog;;45579107;;0", "blog;;11653095;;0", "blog;;6883311;;5"],
        "0-20": ["blog;;8978141;;0", "blog;;38109643;;0", "blog;;19172755;;0"]
    },
    /*WPF+C#*/
    "14": {
        "80-100": ["blog;;50829828;;28", "blog;;20639421;;0", "blog;;8373215;;0"],
        "60-80": ["blog;;9032445;;0", "blog;;9163851;;0", "blog;;46865829;;0"],
        "40-60": ["blog;;16918201;;1", "blog;;6732150;;4", "blog;;6732166;;7"],
        "20-40": ["blog;;45579107;;0", "blog;;11653095;;0", "blog;;9721153;;2"],
        "0-20": ["blog;;19172755;;0", "blog;;38109643;;0", "blog;;20686113;;33"]
    },
    /*UWP+C#*/
    "15": {
        "80-100": ["blog;;50829828;;28", "blog;;20639421;;0", "blog;;8373215;;0"],
        "60-80": ["blog;;9032445;;0", "blog;;9163851;;0", "blog;;8373202;;0"],
        "40-60": ["blog;;17284003;;0", "blog;;51281093;;0", "blog;;8588510;;0"],
        "20-40": ["blog;;48053769;;0", "blog;;45579107;;0", "blog;;11653095;;0"],
        "0-20": ["blog;;8579028;;0", "blog;;38109643;;0", "blog;;19172755;;0"]
    },
    /*Silverlight+C#*/
    "16": {
        "80-100": ["blog;;20639421;;0", "blog;;8373215;;0", "blog;;7785866;;0"],
        "60-80": ["blog;;9032445;;0", "blog;;38868303;;0", "blog;;7823056;;0"],
        "40-60": ["blog;;8494495;;0", "blog;;6732150;;4", "blog;;8219625;;0"],
        "20-40": ["blog;;45579107;;0", "blog;;11653095;;0", "blog;;9721153;;2"],
        "0-20": ["blog;;8978141;;0", "blog;;20626093;;7", "blog;;7617039;;0"]
    },
    /*表单事件+javascript*/
    "17": {
        "80-100": ["blog;;7459895;;0", "blog;;6965925;;0", "blog;;7107567;;0"],
        "60-80": ["blog;;7874358;;0", "blog;;7919568;;0", "blog;;6863868;;0"],
        "40-60": ["blog;;49128123;;0", "blog;;48419771;;0", "blog;;6965926;;0"],
        "20-40": ["blog;;49128781;;0", "blog;;5874632;;0", "blog;;7449157;;0"],
        "0-20": ["blog;;7261086;;5", "blog;;6733113;;0", "blog;;7718352;;0"]
    },
    /*按键事件+javascript*/
    "18": {
        "80-100": ["blog;;43053939;;0", "blog;;43051583;;0", "blog;;50990889;;0"],
        "60-80": ["blog;;50119955;;0", "blog;;9899243;;2", "blog;;7757554;;2"],
        "40-60": ["blog;;44098781;;0", "blog;;6965926;;0", "blog;;7335369;;0"],
        "20-40": ["blog;;8196330;;2", "blog;;9718525;;6", "blog;;49010447;;0"],
        "0-20": ["blog;;6722065;;0", "blog;;16923789;;2", "blog;;50312255;;1"]
    },
    /*event+javascript*/
    "19": {
        "80-100": ["blog;;51089517;;0", "blog;;6965925;;0", "blog;;7423702;;0"],
        "60-80": ["blog;;6719323;;0", "blog;;47255837;;6", "blog;;9899243;;2"],
        "40-60": ["blog;;7069333;;0", "blog;;7708444;;2", "blog;;49946023;;0"],
        "20-40": ["blog;;19680019;;0", "blog;;7558709;;0", "blog;;50639977;;0"],
        "0-20": ["blog;;16923789;;2", "blog;;50312255;;1", "blog;;7286550;;0"]
    },
    /*事件流+javascript*/
    "20": {
        "80-100": ["blog;;43053939;;0", "blog;;50312933;;1", "blog;;43051583;;0"],
        "60-80": ["blog;;44116707;;6", "blog;;41443417;;0", "blog;;51272907;;0"],
        "40-60": ["blog;;8771906;;0", "blog;;44098781;;0", "blog;;46470719;;0"],
        "20-40": ["blog;;46240235;;0", "blog;;44035465;;0", "blog;;28649973;;0"],
        "0-20": ["blog;;45644231;;1", "blog;;46382385;;1", "blog;;45644231;;0"]
    },
    /*监听函数+javascript*/
    "21": {
        "80-100": ["blog;;6965925;;0", "blog;;7824544;;0", "blog;;49585571;;0"],
        "60-80": ["blog;;44116707;;6", "blog;;51043418;;1", "blog;;51272907;;0"],
        "40-60": ["blog;;44098781;;0", "blog;;51073907;;1", "blog;;6611404;;1"],
        "20-40": ["blog;;28649973;;0", "blog;;38235583;;1", "blog;;50485868;;1"],
        "0-20": ["blog;;50825570;;0", "blog;;7045716;;1", "blog;;51168220;;4"]
    },
    /*模块化+javascript*/
    "22": {
        "80-100": ["blog;;7244501;;0", "blog;;7695419;;0", "blog;;6998739;;0"],
        "60-80": ["blog;;7395461;;0", "blog;;47285481;;1", "blog;;49947065;;0"],
        "40-60": ["blog;;7872460;;0", "blog;;7069333;;0", "blog;;51418283;;0"],
        "20-40": ["blog;;47361771;;0", "blog;;50370270;;22", "blog;;48951509;;0"],
        "0-20": ["blog;;50288449;;2", "blog;;7679778;;9", "blog;;7340675;;1"]
    },
    /*javascript+detachEvent*/
    "23": {
        "80-100": ["blog;;50312933;;1", "blog;;9981553;;0", "blog;;42144275;;0"],
        "60-80": ["blog;;7999469;;3", "blog;;48180075;;0", "blog;;7485304;;0"],
        "40-60": ["blog;;44098781;;0", "blog;;8775915;;0", "blog;;40394823;;0"],
        "20-40": ["blog;;42534771;;1", "blog;;6726917;;0", "blog;;8689254;;0"],
        "0-20": ["blog;;7058511;;0", "blog;;51089655;;4", "blog;;7593777;;0"]
    },
    /*javascript+localStorage*/
    "24": {
        "80-100": ["blog;;7244501;;0", "blog;;47042199;;2", "blog;;51071797;;0"],
        "60-80": ["blog;;47070221;;1", "blog;;47285481;;1", "blog;;8741248;;0"],
        "40-60": ["blog;;48321405;;0", "blog;;7294819;;0", "blog;;7927928;;0"],
        "20-40": ["blog;;7829666;;0", "blog;;46561971;;0", "blog;;8864239;;0"],
        "0-20": ["blog;;22719279;;6", "blog;;51278305;;0", "blog;;47123047;;0"]
    },
    /*JavaScript+矢量图*/
    "25": {
        "80-100": ["blog;;40918287;;0", "blog;;35818743;;0", "blog;;43051583;;0"],
        "60-80": ["blog;;7623937;;0", "blog;;7950529;;0", "blog;;7694841;;0"],
        "40-60": ["blog;;44726627;;0", "blog;;8452836;;0", "blog;;11226009;;0"],
        "20-40": ["blog;;40786865;;0", "blog;;7322843;;0", "blog;;8463526;;0"],
        "0-20": ["blog;;7058511;;0", "blog;;6693943;;10", "blog;;39398649;;0"]
    },/*命名空间+PHP*/
    "26": {
        "80-100": ["blog;;7299491;;0", "blog;;6774432;;0", "blog;;48580329;;0"],
        "60-80": ["blog;;49556109;;0", "blog;;7072802;;0", "blog;;41080357;;0"],
        "40-60": ["blog;;45391765;;0", "blog;;50770799;;6", "blog;;49869071;;3"],
        "20-40": ["blog;;8107477;;0", "blog;;7822502;;0", "blog;;50241239;;0"],
        "0-20": ["blog;;48319437;;0", "blog;;50929692;;0", "blog;;41074363;;0"]
    },
    /*cactch+PHP*/
    "27": {
        "80-100": ["blog;;7459559;;0", "blog;;9027013;;0", "blog;;6783460;;0"],
        "60-80": ["blog;;47606111;;0", "blog;;51247558;;0", "blog;;7826400;;0"],
        "40-60": ["blog;;6753686;;0", "blog;;46820009;;0", "blog;;50363805;;0"],
        "20-40": ["blog;;17759537;;0", "blog;;7222736;;0", "blog;;50251051;;2"],
        "0-20": ["blog;;47803513;;0", "blog;;17013295;;0", "blog;;6748717;;3"]
    },
    /*设计模式+PHP（80以上无）*/
    "28": {
        /*"80-100": ["无"],*/
        "60-80": ["blog;;7833136;;0", "blog;;7356220;;0", "blog;;7707554;;0"],
        "40-60": ["blog;;7693576;;0", "blog;;7706954;;0", "blog;;51076215;;0"],
        "20-40": ["blog;;7642897;;1", "blog;;50766755;;0", "blog;;49871939;;1"],
        "0-20": ["blog;;6968111;;3", "blog;;47333763;;0", "blog;;50600041;;1"]
    },
    /*Nginx配置+PHP（80以上无）*/
    "29": {
        /*"80-100": ["无"],*/
        "60-80": ["blog;;7191298;;0", "blog;;8649170;;0", "blog;;7432485;;0"],
        "40-60": ["blog;;17390905;;0", "blog;;51158427;;3", "blog;;8955647;;4"],
        "20-40": ["blog;;9173511;;0", "blog;;40047779;;0", "blog;;7316056;;0"],
        "0-20": ["blog;;17013295;;0", "blog;;7724449;;0", "blog;;12844577;;11"]
    },
    /*Session+PHP（80以上只有1个）*/
    "30": {
        "80-100": ["blog;;7845017;;0"],
        "60-80": ["blog;;46956379;;0", "blog;;6804155;;0", "blog;;7593415;;0"],
        "40-60": ["blog;;7622973;;0", "blog;;7693790;;0", "blog;;49514913;;0"],
        "20-40": ["blog;;50825916;;0", "blog;;50945034;;0", "blog;;47957089;;49"],
        "0-20": ["blog;;50595926;;0", "blog;;6664603;;0", "blog;;50896238;;0"]
    },
    /*php+post*/
    "31": {
        "80-100": ["blog;;41510935;;3", "blog;;50521766;;0", "blog;;38513501;;0"],
        "60-80": ["blog;;46967221;;0", "blog;;48997833;;0", "blog;;24632409;;0"],
        "40-60": ["blog;;7236541;;0", "blog;;7411971;;0", "blog;;49995745;;0"],
        "20-40": ["blog;;48206553;;0", "blog;;6948721;;0", "blog;;7608311;;0"],
        "0-20": ["blog;;47000099;;6", "blog;;7019442;;8", "blog;;6739170;;0"]
    },
    /*php+header（80以上没有）*/
    "32": {
        /*"80-100": ["无"],*/
        "60-80": ["blog;;7733716;;0", "blog;;46983297;;0", "blog;;48577839;;0"],
        "40-60": ["blog;;48134057;;0", "blog;;7759501;;0", "blog;;7437925;;2"],
        "20-40": ["blog;;51105476;;5", "blog;;5973404;;0", "blog;;51207600;;1"],
        "0-20": ["blog;;46818589;;0", "blog;;6642930;;1", "blog;;49490169;;0"]
    },
    /*php+XSS（80分以上只有1个）*/
    "33": {
        "80-100": ["blog;;21182207;;0"],
        "60-80": ["blog;;41791137;;0", "blog;;9531923;;4", "blog;;24632409;;0"],
        "40-60": ["blog;;50315219;;0", "blog;;24429397;;0", "blog;;33731703;;0"],
        "20-40": ["blog;;7653400;;0", "blog;;9154409;;0", "blog;;43561607;;0"],
        "0-20": ["blog;;6883016;;0", "blog;;8615473;;0", "blog;;45114135;;12"]
    },
    /*php+CSRF（80分以上没有）*/
    "34": {
        /*"80-100": ["无"],*/
        "60-80": ["blog;;51026308;;2", "blog;;38513929;;0", "blog;;24632409;;0"],
        "40-60": ["blog;;51203366;;2", "blog;;37872919;;1", "blog;;51026308;;0"],
        "20-40": ["blog;;45269659;;29", "blog;;35331475;;2", "blog;;51026308;;1"],
        "0-20": ["blog;;8500227;;15", "blog;;8606030;;0", "blog;;50806789;;0"]
    },
    /*php+yii（80分以上没有）*/
    "35": {
        /*"80-100": ["无"],*/
        "60-80": ["blog;;49556109;;0", "blog;;47273509;;0", "blog;;7003215;;1"],
        "40-60": ["blog;;50909446;;0", "blog;;50439934;;0", "blog;;6959028;;0"],
        "20-40": ["blog;;48288937;;2", "blog;;50009171;;0", "blog;;50204507;;5"],
        "0-20": ["blog;;6981888;;1", "blog;;51305719;;0", "blog;;50770467;;0"]
    }
}
/************************************  AssemIds  *****************************************/
DataAssembly = {
    AssemIds : function(keyWord){
        var keyIdsObj = CodeIdsData[keyWord];
        var idsList = [];
        for(key in keyIdsObj){
            for(var i=0; i<keyIdsObj[key].length;i++){
                idsList.push(keyIdsObj[key][i]);
            }
        }
        return idsList;
    },
    assemDom : function($resObjDataList){
        var $resObjData = {};
        var temArr1 = [],temArr2 = [],temArr3 = [],temArr4 = [],temArr5 = [];
        for(var i=0; i<$resObjDataList.length; i++){
            var $totalRecord = parseInt($resObjDataList[i]['total']);
            if($totalRecord >= 80){
                temArr1.push($resObjDataList[i]);
            }else if($totalRecord >= 60 && $totalRecord < 80){
                temArr2.push($resObjDataList[i]);
            }
            else if($totalRecord >= 40 && $totalRecord < 60){
                temArr3.push($resObjDataList[i]);
            }
            else if($totalRecord >= 20 && $totalRecord < 40){
                temArr4.push($resObjDataList[i]);
            }
            else{
                temArr5.push($resObjDataList[i]);
            }
        }
        if(temArr1.length > 0){
            $resObjData['80~100'] = temArr1;
        }
        if(temArr2.length > 0){
            $resObjData['60~80'] = temArr2;
        }
        if(temArr3.length > 0){
            $resObjData['40~60'] = temArr3;
        }
        if(temArr4.length > 0){
            $resObjData['20~40'] = temArr4;
        }
        if(temArr5.length > 0){
            $resObjData['0~20'] = temArr5;
        }
        console.log($resObjData);
        return $resObjData;
    }
}
/**************************************  Ajax  *******************************************/
CodeAjax = {
    commonDataAjax : function($idsList, callback){
        var currentIndex=0;//退出递归的条件变量
        var resObjDataList = [];
        function newRequest(){
            if(currentIndex>=$idsList.length){
                return;
            }
            var ids = $idsList[currentIndex];
            $.ajax({
                type: 'GET',
                url : 'http://internalapi.csdn.net/knowledge/public/public/api/snippet?x-acl-token=9DeJLGuYSy/6nSmDQen5amEWUh0K&fields=all&ids=' + ids + '&type=codes_snippet&callback=func',
                /*async: false,*/
                dataType: 'jsonp',
                jsonp : 'callback',
                jsonpCallback : 'func',
                complete:function(responseObj){
                    currentIndex++;
                    var $resJson = responseObj['responseJSON'];
                    var $codeObj = $resJson.codes[ids];
                    var $recordObj = $resJson.records[ids];
                    var temObj = {};
                    temObj['total'] = $recordObj['total'];
                    temObj['naming'] = $recordObj['naming'];
                    temObj['execute'] = $recordObj['execute'];
                    temObj['blank'] = $recordObj['blank'];
                    temObj['indent'] = $recordObj['indent'];
                    temObj['complexity'] = $recordObj['complexity'];
                    temObj['integrity'] = $recordObj['integrity'];
                    temObj['lineWidth'] = $recordObj['lineWidth'];
                    temObj['efficiency'] = $recordObj['efficiency'];
                    temObj['lineOfCode'] = $recordObj['lineOfCode'];
                    temObj['blog'] = $recordObj['blog'];
                    temObj['comments'] = $recordObj['comments'];
                    temObj['grammar'] = $recordObj['grammar'];
                    temObj['snippet_line'] = $codeObj['snippet_line'];
                    temObj['language'] = $codeObj['language'];
                    temObj['source_user_name'] = $codeObj['source_user_name'];
                    temObj['created_at'] = $codeObj['created_at'];
                    temObj['body'] = $codeObj['body'];
                    resObjDataList.push(temObj);
                    if(currentIndex === $idsList.length){
                        callback(DataAssembly.assemDom(resObjDataList));
                    }
                    newRequest();
                }
            });
        }
        newRequest();
    }
}

/******************************** EVENT **********************************************/
//code 展开收起
$(".btn-expand-collapse").click(function(){
    var $fileHolder = $(this).closest("h5").next(".snippets_con");
    var $codeHeight = $fileHolder.find(".file_content").height();
    if($(this).text() === "展开"){
        $fileHolder.css("max-height",$codeHeight+24+"px");
        $(this).text("收起");
    }else if($(this).text() === "收起"){
        $fileHolder.css("max-height",486+"px");
        $(this).text("展开");
    }
});

// code 全屏 退出全屏
$(".btn-fullscreen").click(function(){
    var $fileHolder = $(this).closest("h5").next(".snippets_con");
    var $codeHeight = $fileHolder.find(".file_content").height();
    var h = window.innerHeight;
    if($(this).text() === "全屏"){
        $(this).closest(".code_snippets").addClass("full");
        $(this).text("退出全屏");
        $("html").css("overflow","hidden");
        if($codeHeight < h-24){
            $fileHolder.css("max-height",$codeHeight+24+"px");
        }else{
            $fileHolder.css("max-height",h-44+"px");
        }
    }else if($(this).text() === "退出全屏"){
        $(this).closest(".code_snippets").removeClass("full");
        $(this).text("全屏");
        $("html").css("overflow","auto");
        $fileHolder.css("max-height",486+"px");
    }
})

$(function(){
    var _url = document.location.href;
    $('.key_word_list a').each(function(){
        if(_url.indexOf($(this).attr('href')) > -1){
            $(this).parent('li').addClass('active');
            var $keyWord = $(this).parent('li').attr('data-key-words');
            var $idsList = DataAssembly.AssemIds($keyWord);
            CodeAjax.commonDataAjax($idsList,function(resData){
                var $languageType = "";
                var $containerStr = "";
                for(key in resData){
                    if(resData[key].length>0){
                        $containerStr +=
                            "<dl class='code_segment'>"
                                +"<dt class='code_segment_tit'>" + key + "分<span></span>代码片</dt>";
                        for(var i = 0; i<resData[key].length; i++){
                            if(resData[key][i]['language'] === "java"){
                                $languageType = "java";
                            }else if(resData[key][i]['language'] === "python"){
                                $languageType = "python";
                            }else if(resData[key][i]['language'] === "csharp"){
                                $languageType = "c-sharp";
                            }else if(resData[key][i]['language'] === "javascript"){
                                $languageType = "js";
                            }else if(resData[key][i]['language'] === "php"){
                                $languageType = "php";
                            }
                            $containerStr +=
                                "<dd class='code_segment_con'>"
                                    +"<div class='row'>"
                                        +"<div class='col-md-3 col-sm-3 col-xs-3'>"
                                            +"<div class='score_table'>"
                                                +"<table class='table table-bordered table-condensed text-center'>"
                                                    +"<thead><tr><th>名称</th><th>得分</th></tr></thead>"
                                                    +"<tbody>"
                                                        +"<tr><td>total</td><td>" + resData[key][i].total + "</td></tr>"
                                                        +"<tr><td>naming</td><td>" + resData[key][i].naming + "</td></tr>"
                                                        +"<tr><td>execute</td><td>" + resData[key][i].execute + "</td></tr>"
                                                        +"<tr><td>blank</td><td>" + resData[key][i].blank + "</td></tr>"
                                                        +"<tr><td>indent</td><td>" + resData[key][i].indent + "</td></tr>"
                                                        +"<tr><td>complexity</td><td>" + resData[key][i].complexity + "</td></tr>"
                                                        +"<tr><td>integrity</td><td>" + resData[key][i].integrity + "</td></tr>"
                                                        +"<tr><td>lineWidth</td><td>" + resData[key][i].lineWidth + "</td></tr>"
                                                        +"<tr><td>efficiency</td><td>" + resData[key][i].efficiency + "</td></tr>"
                                                        +"<tr><td>lineOfCode</td><td>" + resData[key][i].lineOfCode + "</td></tr>"
                                                        +"<tr><td>blog</td><td>" + resData[key][i].blog + "</td></tr>"
                                                        +"<tr><td>comments</td><td>" + resData[key][i].comments + "</td></tr>"
                                                        +"<tr><td>grammar</td><td>" + resData[key][i].grammar + "</td></tr>"
                                                    +"</tbody>"
                                                +"</table>"
                                                +"<a class='score_desc' data-toggle='modal' href='#modal-recordDesc'>分数计算过程说明<i class='fa fa-question-circle'></i></a>"
                                            +"</div>"
                                        +"</div>"
                                        +"<div class='col-md-9 col-sm-9 col-xs-9'>"
                                            +"<div class='code_snippets'>"
                                                +"<h5 class='clearfix code_snippets_header'>"
                                                    +"<div class='pull-left'>"
                                                        +"<i class='fa fa-file-text-o'></i>"
                                                        +"<span>" + resData[key][i]['snippet_line'] + "行</span>"
                                                        +"<span>" + resData[key][i]['language'] + "</span>"
                                                        +"<span>作者：<small>" + resData[key][i]['source_user_name'] + "</small></span>"
                                                        +"<span>时间：<small>" + resData[key][i]['created_at'] + "</small></span>"
                                                        +"<span class='quality_score'>质量分：<small>" + resData[key][i].total + "</small></span>"
                                                    +"</div>"
                                                    +"<div class='btn-group pull-right' role='group' aria-label='...'>"
                                                        +"<button type='button' class='btn btn-default btn-expand-collapse' data-mod='popu_180'><a href='javascript:;' target='_blank'>展开</a></button>"
                                                        +"<button type='button' class='btn btn-default btn-fullscreen' data-mod='popu_181'><a href='javascript:;' target='_blank'>全屏</a></button>"
                                                    +"</div>"
                                                +"</h5>"
                                                +"<div class='snippets_con'>"
                                                    +"<div class='file_content'>"
                                                        +"<pre name='code' class='brush: " + $languageType + ";'>" + resData[key][i]['body'] + "</pre>"
                                                    +"</div>"
                                                +"</div>"
                                            +"</div>"
                                        +"</div>"
                                    +"</div>"
                                +"</dd>";
                        }
                        $containerStr += "</dl>";
                    }
                    $(".code_section").html($containerStr);
                    var $curKeyWords = $(".key_word_list").find('li.active').text();
                    $(".code_section").find('.code_segment_tit span').text($curKeyWords);
                }
            });
        }
    });

    SyntaxHighlighter.defaults['smart-tabs'] = true;
    SyntaxHighlighter.defaults['collapse']="collapse";
    SyntaxHighlighter.config.bloggerMode = true;
    SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
    SyntaxHighlighter.all();
})





